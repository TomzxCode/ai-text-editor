<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Text Editor</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
    <!-- CodeMirror Theme CSS Files -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/3024-day.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/3024-night.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/abbott.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/abcdef.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/ambiance.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/ayu-dark.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/ayu-mirage.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/base16-dark.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/base16-light.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/bespin.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/blackboard.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/cobalt.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/colorforth.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/darcula.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/duotone-dark.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/duotone-light.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/eclipse.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/elegant.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/erlang-dark.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/gruvbox-dark.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/hopscotch.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/icecoder.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/idea.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/isotope.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/juejin.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/lesser-dark.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/liquibyte.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/lucario.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material-darker.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material-ocean.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material-palenight.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/mbo.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/mdn-like.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/midnight.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/monokai.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/moxer.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/neat.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/neo.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/night.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/nord.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/oceanic-next.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/panda-syntax.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/paraiso-dark.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/paraiso-light.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/pastel-on-dark.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/railscasts.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/rubyblue.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/seti.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/shadowfox.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/solarized.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/the-matrix.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/tomorrow-night-bright.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/tomorrow-night-eighties.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/ttcn.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/twilight.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/vibrant-ink.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/xq-dark.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/xq-light.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/yeti.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/yonce.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/zenburn.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/choices.js/10.2.0/choices.min.css">
    <link rel="icon" href="icons/192x192.jpg">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#007acc">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="AI Editor">
    <link rel="apple-touch-icon" href="icons/192x192.jpg">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <h1>AI Text Editor</h1>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Hidden Sidebar Pull Tabs -->
            <div class="sidebar-pull-tab left-pull-tab hidden" id="leftPullTab"></div>
            <div class="sidebar-pull-tab right-pull-tab hidden" id="rightPullTab"></div>
            
            <!-- File Explorer -->
            <aside class="file-explorer" id="fileExplorer">
                <div class="explorer-header">
                    <h3>Files</h3>
                    <button class="btn-compact" id="selectDirectoryBtn">Select Directory</button>
                    <button class="close-panel" id="closeExplorer">×</button>
                </div>
                <div class="file-search" id="fileSearch" style="display: none;">
                    <input type="text" placeholder="Search files..." id="fileSearchInput" class="search-input">
                    <button class="search-clear" id="searchClear">×</button>
                </div>
                <div class="file-tree" id="fileTree">
                    <p class="no-files">No directory selected</p>
                </div>
            </aside>

            <!-- Left Resize Handle -->
            <div class="resize-handle left-resize" id="leftResize"></div>

            <!-- Editor Section -->
            <section class="editor-section">
                <div class="editor-header">
                    <div class="editor-info">
                        <span class="current-file" id="currentFile">No file selected</span>
                        <div class="text-stats">
                            <span class="stat-item" id="wordCount">0 words</span>
                            <span class="stat-separator">•</span>
                            <span class="stat-item" id="sentenceCount">0 sentences</span>
                            <span class="stat-separator">•</span>
                            <span class="stat-item" id="paragraphCount">0 paragraphs</span>
                            <span class="stat-separator">•</span>
                            <span class="stat-item" id="costDisplay">$0.00</span>
                            <span class="stat-separator">•</span>
                            <span class="stat-item" id="callsCount">0 calls</span>
                            <span class="stat-separator">•</span>
                            <span class="stat-item" id="inputTokens">0 in</span>
                            <span class="stat-separator">•</span>
                            <span class="stat-item" id="outputTokens">0 out</span>
                        </div>
                    </div>
                    <div class="editor-actions">
                        <button class="btn-secondary" id="promptPaletteBtn" title="Open Prompt Palette (Ctrl+K)">⚡</button>
                        <button class="btn-secondary" id="newFileBtn">New</button>
                        <button class="btn-secondary" id="saveFileBtn" disabled>Save</button>
                    </div>
                </div>
                <div class="editor-container">
                    <textarea id="textEditor" placeholder="Select a file to start editing or create a new file..."></textarea>
                </div>
            </section>

            <!-- Right Resize Handle -->
            <div class="resize-handle right-resize" id="rightResize"></div>

            <!-- AI Feedback Sidebar -->
            <aside class="ai-sidebar" id="aiSidebar">
                <div class="sidebar-header">
                    <h3>AI Assistant</h3>
                    <button class="close-panel" id="closeSidebar">×</button>
                </div>

                <!-- Tab Navigation -->
                <div class="tab-nav">
                    <button class="tab-btn" id="feedbackTab" data-tab="feedback">Feedback</button>
                    <button class="tab-btn" id="promptsTab" data-tab="prompts">Prompts</button>
                    <button class="tab-btn" id="inspectTab" data-tab="inspect">Inspect</button>
                    <button class="tab-btn" id="historyTab" data-tab="history">History</button>
                    <button class="tab-btn" id="usageTab" data-tab="usage">Usage</button>
                    <button class="tab-btn" id="settingsTab" data-tab="settings">Settings</button>
                </div>

                <!-- Feedback Tab Content -->
                <div class="tab-content" id="feedbackTabContent">
                    <div class="feedback-container" id="feedbackContainer">
                        <div class="feedback-item placeholder-message" id="initialPlaceholder">
                            <h4>🤖 AI Assistant</h4>
                            <p>Open a file or start typing to get AI-powered writing suggestions.</p>
                            <p><small>The AI will analyze your text and provide feedback for style, grammar, structure, and more.</small></p>
                        </div>
                    </div>

                </div>

                <!-- Prompts Tab Content -->
                <div class="tab-content" id="promptsTabContent">
                    <div class="prompts-section">
                        <!-- Groups Management -->
                        <div class="section-header">
                            <h4>Prompt Groups</h4>
                            <button class="btn-small" id="addGroupBtn" title="Add new group">+</button>
                        </div>
                        <div class="group-selector">
                            <select id="activeGroupSelect" class="group-select">
                                <option value="">Loading groups...</option>
                            </select>
                            <button class="btn-small" id="editGroupBtn" title="Edit group">✎</button>
                            <button class="btn-small" id="deleteGroupBtn" title="Delete group">🗑</button>
                        </div>

                        <!-- Prompts in Active Group -->
                        <div class="section-header">
                            <h4 id="promptsSectionTitle">Prompts</h4>
                            <div class="header-actions">
                                <button class="btn-small" id="toggleAllPromptsBtn" title="Toggle all prompts">⚪</button>
                                <button class="btn-small" id="addPromptBtn">+</button>
                            </div>
                        </div>
                        <div class="prompts-list" id="promptsList">
                            <p class="no-prompts">No prompts yet. Click + to add one.</p>
                        </div>
                    </div>
                </div>

                <!-- Inspect Tab Content -->
                <div class="tab-content" id="inspectTabContent">
                    <div class="inspect-section">
                        <div class="section-header">
                            <h4>Text Structure</h4>
                            <button class="btn-small" id="refreshInspectBtn">⟳</button>
                        </div>
                        
                        <!-- Stats Overview -->
                        <div class="inspect-stats" id="inspectStats">
                            <div class="stat-grid">
                                <div class="stat-item">
                                    <span class="stat-value" id="inspectSentenceCount">-</span>
                                    <span class="stat-label">Sentences</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value" id="inspectWordCount">-</span>
                                    <span class="stat-label">Words</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value" id="inspectParagraphCount">-</span>
                                    <span class="stat-label">Paragraphs</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value" id="inspectTextVersion">-</span>
                                    <span class="stat-label">Version</span>
                                </div>
                            </div>
                        </div>

                        <!-- View Controls -->
                        <div class="inspect-controls">
                            <div class="control-group">
                                <label class="control-label">View:</label>
                                <select id="inspectView" class="control-select">
                                    <option value="sentences">Sentences</option>
                                    <option value="paragraphs">Paragraphs</option>
                                    <option value="words">Words</option>
                                    <option value="structure" selected>Full Structure</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label class="control-label">Filter:</label>
                                <input type="text" id="inspectFilter" class="control-input" placeholder="Filter by content...">
                            </div>
                        </div>

                        <!-- Content Display -->
                        <div class="inspect-content" id="inspectContent">
                            <div class="inspect-placeholder">
                                <p>📝 Start typing in the editor to see text structure analysis</p>
                                <p><small>This panel shows real-time breakdown of sentences, words, and paragraphs with unique identifiers.</small></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- History Tab Content -->
                <div class="tab-content" id="historyTabContent">
                    <!-- Content will be populated by HistoryManager.js -->
                </div>

                <!-- Usage Tab Content -->
                <div class="tab-content" id="usageTabContent">
                    <!-- Content will be populated by UsageTracker.js -->
                </div>

                <!-- Settings Tab Content -->
                <div class="tab-content" id="settingsTabContent">
                    <div class="settings-section">
                        <div class="section-header">
                            <h4>Editor Settings</h4>
                        </div>
                        <div class="settings-content">
                            <div class="setting-group">
                                <label for="fontFamily">Font Family:</label>
                                <select id="fontFamily" class="setting-select">
                                    <option value="'JetBrains Mono', 'Fira Code', 'Consolas', monospace">JetBrains Mono</option>
                                    <option value="'Fira Code', 'Consolas', monospace">Fira Code</option>
                                    <option value="'Source Code Pro', monospace">Source Code Pro</option>
                                    <option value="'Monaco', 'Menlo', monospace" selected>Monaco</option>
                                    <option value="'Consolas', monospace">Consolas</option>
                                    <option value="'Courier New', monospace">Courier New</option>
                                    <option value="monospace">System Monospace</option>
                                </select>
                            </div>
                            <div class="setting-group">
                                <label for="fontSize">Font Size:</label>
                                <div class="font-size-controls">
                                    <input type="range" id="fontSize" class="setting-range" min="10" max="24" value="14" step="1">
                                    <span id="fontSizeValue" class="setting-value">14px</span>
                                </div>
                            </div>
                            <div class="setting-group">
                                <label for="theme">Editor Theme:</label>
                                <select id="theme" class="setting-select">
                                    <option value="material" selected>Material</option>
                                </select>
                            </div>
                            <div class="setting-group">
                                <label for="uiTheme">UI Theme:</label>
                                <select id="uiTheme" class="setting-select">
                                    <option value="dark" selected>Dark</option>
                                    <option value="light">Light</option>
                                </select>
                            </div>
                            <div class="setting-group">
                                <label>
                                    <input type="checkbox" id="enableAIFeedback">
                                    Enable AI Feedback
                                </label>
                                <p class="setting-description">When enabled, the editor will automatically analyze your text and provide AI-powered writing suggestions.</p>
                            </div>
                        </div>
                        <div class="section-header">
                            <h4>AI Configuration</h4>
                        </div>
                        <div class="settings-content">
                            <div class="setting-group">
                                <label for="apiKey">API Key:</label>
                                <input type="text" id="apiKey" class="setting-input" placeholder="Enter your API key">
                                <p class="setting-description">API key for your chosen LLM service (Groq, OpenAI, etc.)</p>
                            </div>
                            <div class="setting-group">
                                <label for="llmService">LLM Service:</label>
                                <select id="llmService" class="setting-select">
                                    <option value="anthropic">Anthropic</option>
                                    <option value="google">Google</option>
                                    <option value="groq">Groq</option>
                                    <option value="ollama">Ollama</option>
                                    <option value="openai">OpenAI</option>
                                </select>
                                <p class="setting-description">Choose your preferred LLM provider</p>
                            </div>
                            <div class="setting-group">
                                <label for="llmModel">Model:</label>
                                <select id="llmModel" class="setting-select">
                                    <option value="">Loading models...</option>
                                </select>
                                <p class="setting-description">Model for the selected service</p>
                            </div>
                            <div class="setting-group">
                                <label for="customBaseUrl">Custom Base URL (Optional):</label>
                                <input type="url" id="customBaseUrl" class="setting-input" placeholder="e.g., https://api.example.com/v1">
                                <p class="setting-description">Override the default API endpoint for your LLM service. Useful for custom deployments or proxies.</p>
                            </div>
                        </div>

                        <div class="section-header">
                            <h4>Custom LLM Services</h4>
                            <button class="btn-small" id="addCustomServiceBtn" title="Add Custom Service">+</button>
                        </div>
                        <div class="settings-content">
                            <div class="custom-services-list" id="customServicesList">
                                <!-- Custom services will be populated here -->
                            </div>
                            <div class="setting-group" id="customServiceForm" style="display: none;">
                                <div class="custom-service-inputs">
                                    <div class="input-group">
                                        <label for="customServiceName">Service Name:</label>
                                        <input type="text" id="customServiceName" class="setting-input" placeholder="My Custom Service">
                                    </div>
                                    <div class="input-group">
                                        <label for="customServiceKey">Service Key:</label>
                                        <input type="text" id="customServiceKey" class="setting-input" placeholder="my-service" pattern="[a-z0-9-]+" title="Only lowercase letters, numbers, and hyphens allowed">
                                        <small>Used internally - lowercase letters, numbers, and hyphens only</small>
                                    </div>
                                    <div class="input-group">
                                        <label for="customServiceUrl">Base URL (Optional):</label>
                                        <input type="text" id="customServiceUrl" class="setting-input" placeholder="https://api.example.com/v1">
                                        <small>API endpoint URL for this service</small>
                                    </div>
                                </div>
                                <div class="custom-service-actions">
                                    <button class="btn-primary" id="saveCustomServiceBtn">Add Service</button>
                                    <button class="btn-secondary" id="cancelCustomServiceBtn">Cancel</button>
                                </div>
                            </div>
                        </div>

                        <div class="section-header">
                            <h4>Import / Export</h4>
                        </div>
                        <div class="settings-content">
                            <div class="import-export-stats" id="importExportStats">
                                <div class="stats-loading">Loading storage stats...</div>
                            </div>
                            
                            <div class="setting-group">
                                <h5>Export Data</h5>
                                <p class="setting-description">Download all your settings, prompts, and AI history as a backup file.</p>
                                <div class="import-export-actions">
                                    <button class="btn-primary" id="exportDataBtn">
                                        <span class="btn-icon">⬇️</span>
                                        Export All Data
                                    </button>
                                </div>
                            </div>

                            <div class="setting-group">
                                <h5>Import Data</h5>
                                <p class="setting-description">Import settings, prompts, and AI history from a backup file.</p>
                                <div class="import-export-actions">
                                    <input type="file" id="importFileInput" accept=".json" style="display: none;">
                                    <button class="btn-secondary" id="importDataBtn">
                                        <span class="btn-icon">⬆️</span>
                                        Import Data
                                    </button>
                                </div>
                                <div class="import-options" id="importOptions" style="display: none;">
                                    <div class="option-group">
                                        <label>
                                            <input type="checkbox" id="overwriteData" checked>
                                            Overwrite existing data
                                        </label>
                                        <small>If unchecked, new items will be merged with existing ones</small>
                                    </div>
                                    <div class="option-group">
                                        <label>Import Selection:</label>
                                        <div class="checkbox-group">
                                            <label>
                                                <input type="checkbox" id="importSettings" checked>
                                                Settings
                                            </label>
                                            <label>
                                                <input type="checkbox" id="importPrompts" checked>
                                                Prompts & Groups
                                            </label>
                                            <label>
                                                <input type="checkbox" id="importHistory" checked>
                                                AI History
                                            </label>
                                        </div>
                                    </div>
                                    <div class="import-actions">
                                        <button class="btn-primary" id="confirmImportBtn">Import Selected</button>
                                        <button class="btn-secondary" id="cancelImportBtn">Cancel</button>
                                    </div>
                                </div>
                            </div>

                            <div class="setting-group">
                                <div class="import-export-actions">
                                    <button class="btn-danger btn-small" id="resetAllDataBtn">
                                        <span class="btn-icon">🗑️</span>
                                        Reset All Data
                                    </button>
                                </div>
                            </div>

                            <div class="setting-group cloud-storage-section" style="display: none;">
                                <h5>Cloud Storage</h5>
                                <p class="setting-description">Save and sync your data to cloud storage services.</p>
                                <div class="cloud-providers">
                                    <button class="btn-cloud" id="googleDriveBtn" disabled>
                                        <span class="cloud-icon">📂</span>
                                        Google Drive
                                        <small>Coming Soon</small>
                                    </button>
                                    <button class="btn-cloud" id="dropboxBtn" disabled>
                                        <span class="cloud-icon">📦</span>
                                        Dropbox
                                        <small>Coming Soon</small>
                                    </button>
                                    <button class="btn-cloud" id="oneDriveBtn" disabled>
                                        <span class="cloud-icon">☁️</span>
                                        OneDrive
                                        <small>Coming Soon</small>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
        </main>

        <!-- Mobile Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-btn" id="filesNavBtn">
                <span class="nav-icon">📁</span>
                <span class="nav-label">Files</span>
            </button>
            <button class="nav-btn" id="editorNavBtn">
                <span class="nav-icon">✏️</span>
                <span class="nav-label">Editor</span>
            </button>
            <button class="nav-btn" id="aiNavBtn">
                <span class="nav-icon">🤖</span>
                <span class="nav-label">AI</span>
            </button>
        </nav>
    </div>

    <!-- Prompt Modal -->
    <div class="modal-overlay" id="promptModal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 id="promptModalTitle">Add Prompt</h3>
                <button class="modal-close" id="closePromptModal">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="promptName">Name:</label>
                    <input type="text" id="promptName" placeholder="e.g., Technical Writing Review">
                </div>
                <div class="form-group">
                    <label for="promptText">Prompt:</label>
                    <textarea id="promptText" placeholder="Enter your prompt here. Use {text} for full text, {sentence} for current sentence, {word} for last completed word, or {paragraph} for current paragraph." rows="4"></textarea>
                    <p class="form-hint">💡 <strong>Available placeholders:</strong> {text} (full text), {sentence} (current sentence being edited), {word} (last completed word), {paragraph} (current paragraph). Place placeholders at the beginning for better prompt caching and faster responses.</p>
                </div>
                <div class="form-group">
                    <label for="promptTriggerTiming">Trigger refresh:</label>
                    <select id="promptTriggerTiming">
                        <option value="custom">Custom delay</option>
                        <option value="word">On each word completion</option>
                        <option value="sentence">On each sentence completion</option>
                        <option value="paragraph">On each paragraph completion</option>
                        <option value="keyboard">Keyboard shortcut</option>
                    </select>
                    <p class="form-hint">Choose when to trigger a new AI feedback request for this prompt.</p>
                </div>
                <div class="form-group" id="customDelayGroup">
                    <label for="promptCustomDelay">Custom delay:</label>
                    <input type="text" id="promptCustomDelay" placeholder="e.g., 5s, 2m 30s, 1h, 1m 30s" maxlength="50">
                    <p class="form-hint">Format: Ad Bh Cm Ds (e.g., "2m 30s" for 2 minutes 30 seconds, "5s" for 5 seconds)</p>
                </div>
                <div class="form-group" id="keyboardShortcutGroup" style="display: none;">
                    <label for="promptKeyboardShortcut">Keyboard shortcut:</label>
                    <input type="text" id="promptKeyboardShortcut" placeholder="e.g., Ctrl+Shift+A, Alt+P, F5" maxlength="30" readonly>
                    <p class="form-hint">Click in the input and press the key combination you want to use. Multiple prompts can share the same shortcut and will all trigger together. Common formats: Ctrl+Key, Alt+Key, Ctrl+Shift+Key, F1-F12.</p>
                </div>
                <div class="form-group">
                    <label>Provider Selection:</label>
                    <div id="providersList" class="providers-list">
                        <!-- Dynamic provider selection will be populated here -->
                    </div>
                    <button type="button" class="btn-secondary" id="addProviderBtn">+ Add Provider</button>
                    <p class="form-hint">Select multiple providers+models to run in parallel. Results will be shown together. Leave empty to use global settings.</p>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="promptEnabled" checked>
                        Enabled
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelPromptBtn">Cancel</button>
                <button class="btn-primary" id="savePromptBtn">Save</button>
            </div>
        </div>
    </div>

    <!-- Group Modal -->
    <div class="modal-overlay" id="groupModal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 id="groupModalTitle">Add Group</h3>
                <button class="modal-close" id="closeGroupModal">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="groupName">Group Name:</label>
                    <input type="text" id="groupName" placeholder="e.g., Writing Review, Code Analysis" maxlength="50">
                </div>
                <div class="form-group">
                    <label>Select Prompts for this Group:</label>
                    <input type="text" id="groupPromptsFilter" placeholder="Filter prompts..." class="filter-input">
                    <div class="prompts-checkboxes" id="groupPromptsList">
                        <!-- Dynamic prompt checkboxes will be populated here -->
                    </div>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="groupSetActive">
                        Set as active group
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelGroupBtn">Cancel</button>
                <button class="btn-primary" id="saveGroupBtn">Save</button>
            </div>
        </div>
    </div>

    <!-- Custom Prompt Modal -->
    <div class="modal-overlay" id="customPromptModal" style="display: none;">
        <div class="modal custom-prompt-modal">
            <div class="modal-header">
                <h3>Custom AI Prompt</h3>
                <button class="modal-close" id="closeCustomPromptModal">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="customPromptText">Enter your custom prompt:</label>
                    <textarea id="customPromptText" placeholder="e.g., Translate this text to Spanish, or Fix grammar and spelling..." rows="3" maxlength="500"></textarea>
                    <p class="form-hint">The selected text will be automatically included with your prompt.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelCustomPromptBtn">Cancel</button>
                <button class="btn-primary" id="submitCustomPromptBtn">Apply</button>
            </div>
        </div>
    </div>

    <!-- Prompt Palette -->
    <div class="prompt-palette-overlay" id="promptPalette" style="display: none;">
        <div class="prompt-palette">
            <div class="palette-header">
                <input type="text" id="paletteSearch" class="palette-search" placeholder="Search prompts..." autocomplete="off">
                <div class="palette-shortcut-hint">↑↓ navigate • ⏎ execute • ctrl+1-9 quick select • esc close</div>
            </div>
            <div class="palette-content">
                <div id="palettePromptList" class="palette-prompt-list">
                    <!-- Prompts will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <p>Processing...</p>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/markdown/markdown.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/choices.js/10.2.0/choices.min.js"></script>
    <!-- Component scripts -->
    <script src="components/SearchableDropdown.js"></script>
    <script src="components/NotificationManager.js"></script>
    <script src="components/SessionManager.js"></script>
    <script src="components/FileSystemManager.js"></script>
    <script src="components/EditorManager.js"></script>
    <script src="components/LLMCallStorage.js"></script>
    <script src="components/UsageTracker.js"></script>
    <script src="components/HistoryManager.js"></script>
    <script src="components/AIService.js"></script>
    <script src="components/UIManager.js"></script>
    <script src="components/PromptsManager.js"></script>
    <script src="components/SettingsManager.js"></script>
    <script src="components/ThemeManager.js"></script>
    <script src="components/SentenceDataModel.js"></script>
    <script src="components/FeedbackAssociationManager.js"></script>
    <script src="components/TextAnalysisManager.js"></script>
    <script src="components/InspectManager.js"></script>
    <script src="components/ContextMenuManager.js"></script>
    <script src="components/PromptPaletteManager.js"></script>
    <script src="components/ImportExportManager.js"></script>
    <!-- Main application script -->
    <script src="script.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>
